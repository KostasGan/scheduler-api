<!DOCTYPE html>

<html>

<head>
    <title>Event Scheduler</title>
    <link rel="icon" href="calendar-clock-icon.png">
    <meta charset='utf-8' />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <link rel="stylesheet" type="text/css" href="site-assets/css/home-page.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script>
        var CLIENT_ID = '22469461720-5s0vadaqi6cli0vpe4b0268b20huc20l.apps.googleusercontent.com';
        var api = 'http://35.190.151.137:8080';
        var googleUser;

        function handleClientLoad() {
            gapi.load('auth2', () => {
                gapi.auth2.init({
                    'client_id': CLIENT_ID
                }).then((googleAuth) => {
                    let cookie = document.cookie;
                    let validCookie = cookie.indexOf('G_AUTH=true') != -1;

                    if (cookie && validCookie && googleAuth.isSignedIn.get()) {
                        googleUser = googleAuth.currentUser.get();
                    }
                    else {
                        gapi.auth2.getAuthInstance().signOut();
                        window.location.pathname = '/login.html';
                    }
                }).catch((e) => {
                    console.log(e)
                });
            }, (e) => {
                console.log(e);
            });
        };
    </script>
</head>

<body>
    <div class="flex-container">
        <div class="logo">
            <img src="calendar-clock-icon.png" width="50" height="50">
        </div>
        <div class="d-none d-md-block">
            <h6>Event-Scheduler</h6>
        </div>
        <div class="logout d-flex" onclick="SignOutUser()">
            <a href="/login.html" class="ml-auto" style="color:black">
                <i class="fa fa-sign-out"></i>
            </a>
        </div>
    </div>
    <div class="container">
        <form id="form1" class="col-sm-10" autocomplete="off">
            <div class="form-group row">
                <div class="col-12 col-sm-6">
                    <label for="event_date"> Event Date </label>
                    <input id="event_date" class="form-control" readonly required>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-12 col-sm-6">
                    <label for="duration"> Event Duration </label>
                    <input type="number" id="duration" class="form-control" min="10" max="300" step="5" required>
                    <small for="duration" class="text-muted">Must be in minutes</small>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-12 col-sm-6">
                    <label for="available_time"> Availablility Time</label>
                    <input type="text" id="available_time" class="form-control" required>
                    <small for="available_time" class="text-muted">eg."8:00-14:00,0,...". Zero for free days</small>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-12 col-sm-6">
                    <label for="attendees"> Attendees </label>
                    <input type="text" id="attendees" class="form-control" required>
                    <small for="attendees" class="text-muted">eg. 'test@test.com,test@test.com'</small>
                    <div>
                        <div id="msg"></div>
                    </div>
                </div>
            </div>
            <div class="form-group row">
                <div class="sk col">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </div>
            <div class="form-group msg row">
                <div class="sk col">
                    <div id="resp_msg"></div>
                </div>
            </div>
        </form>
    </div>
    <footer>
        <script async defer src="https://apis.google.com/js/platform.js?onload=handleClientLoad"></script>
        <script type="text/javascript" src="site-assets/js/home-page.js"></script>
        <script type="text/javascript" src="site-assets/js/home-page-func.js"></script>
        <script>
            document.getElementById('form1').addEventListener('submit', function (event) {
                event.preventDefault();
                
                let available_time = document.getElementById('available_time').value;
                let attendees = document.getElementById('attendees').value;

                checkAvailableTime(available_time);
                checkValidEmails(attendees);

                if (document.getElementsByClassName('error').length > 0) {
                    return;
                } else {
                    let event_duration = document.getElementById('duration').value;

                    if (!event_start && !event_end) {
                        let value = document.getElementById('event_date').value;
                        let spltVal = value.split(' - ');

                        event_start = moment(spltVal[0], 'DD-MM-YYYY').format('YYYY-MM-DD').toString();
                        event_end = moment(spltVal[1], 'DD-MM-YYYY').format('YYYY-MM-DD').toString();
                    }

                    let data = {
                        event_start: event_start,
                        event_end: event_end,
                        event_duration: event_duration,
                        available_time: available_time,
                        attendees: attendees
                    };

                    document.getElementById('resp_msg').innerHTML = '';
                    document.querySelector('.btn').setAttribute('disabled', true);
                    submitForm(data);
                }
            }, true);
        </script>
    </footer>
</body>

</html>